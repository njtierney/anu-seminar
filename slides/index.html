<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Exploring and understanding the individual experience from longitudinal data, or…</title>
    <meta charset="utf-8" />
    <meta name="author" content="Nicholas Tierney, Monash University" />
    <link href="libs/font-awesome-5.3.1/css/fontawesome-all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="njtheme.css" type="text/css" />
    <link rel="stylesheet" href="extra.css" type="text/css" />
    <link rel="stylesheet" href="animate.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: left, middle, inverse, title-slide

# Exploring and understanding the individual experience from longitudinal data, or…
## <em>How to make better spaghetti (plots)</em>
### <span style="font-size: 90%;">Nicholas Tierney, Monash University</span>
### <span style="font-size: 90%;">ANU <br><br> Thursday 14th November, 2019 </span><br><br> <i class="fas  fa-link "></i> <a href="https://bit.ly/njt-anu">bit.ly/njt-anu</a><br><br><i class="fab  fa-twitter "></i> <a href="https://twitter.com/nj_tierney">nj_tierney</a>

---


layout: true
&lt;div class="my-footer"&gt;&lt;span&gt;bit.ly/njt-anu • @nj_tierney&lt;/span&gt;&lt;/div&gt; 









---
class: inverse, middle, centre

.huge[
(My) Background
]

???

 I want to talk a bit about where I've started from, because I think it might be useful to understand my perspective, and why I'm interested in doing these things.

---

## Background: Undergraduate

.pull-left.large[
Undergraduate in Psychology

- Statistics
- Experiment Design
- Cognitive Theory
- Neurology
- Humans
]

.pull-right[
&lt;img src="imgs/psy_brain.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## Background: Honours

.left-code.medium[
Psychophysics: illusory contours in 3D

&lt;img src="imgs/phil-grove.jpeg" width="50%" style="display: block; margin: auto;" /&gt;

Phil Grove

]

.right-plot[
&lt;img src="imgs/kanizsa-triangle.png" width="444" style="display: block; margin: auto;" /&gt;
]

---

## Background: Undergraduate

.left-code.medium[
&lt;img src="imgs/christina-lee.jpeg" width="50%" style="display: block; margin: auto;" /&gt;

Christina Lee

]

.right-plot.medium[
&gt; If every psychologist in the world delivered gold standard smoking cessation therapy, the rate of smoking would still increase. You need to change policy to make change. To make effective policy, you need to have good data, and do good statistics.
]

???

I discovered an interest in public health and statistics.

---

## Background: PhD

.pull-left.large[
- "Ah, statistics, everything is black and white!
- "There's always an answer"
- "data in, answer out"
]


.pull-right[
&lt;img src="imgs/bw-mountains.jpg" width="1778" style="display: block; margin: auto;" /&gt;

]

???

I started a PhD in statistics at QUT, under (now distinguished) Professor Kerrie Mengersen, Looking at people's health over time.

- There were several things that I noticed:
  - There were equations, but not as many clear-cut, black and white answers
  
---

## Background: PhD

.pull-left.large[

- Data is really messy
- Missing values are frustrating
- How to Explore data?

]

.pull-right[
&lt;img src="imgs/explorer.jpg" width="569" style="display: block; margin: auto;" /&gt;

]


  
---

## Background: PhD - But in psych

.pull-left.large[
- Focus on experiment design
- No focus on exploring data
- Exploring data felt...wrong?
- But it was so critical.
]

.pull-right[
&lt;img src="imgs/sound-barrier.jpg" width="853" style="display: block; margin: auto;" /&gt;

]


---

## (My personal) motivation

.large[
- A lot of research in new statistical methods - imputation, inference, prediction
- Not much research on how we explore our data, and the methods that we use to do this.
]

---

## (My personal) motivation

.pull-left[
&lt;img src="imgs/bw-bridge.jpg" width="2560" style="display: block; margin: auto;" /&gt;

]

.pull-right.large[
  &gt; Focus on building a bridge across a river. Less focus on **how** it is built, and the **tools** used.
]

???

- I became very interested in how we explore our data - exploratory data analysis.

---
class: inverse, middle, center

.huge[
My research:

Design and improve tools for (exploratory) data analysis
]

---
    
# EDA: Exploratory Data Analysis

.large[
&gt; ...EDA is an approach to analyzing data sets to summarize their main characteristics, often with visual methods. (Wikipedia)

John Tukey, Frederick Mosteller, Bill Cleveland, Dianne Cook, Heike Hoffman, Rob Hyndman, Hadley Wickham
]

---

# EDA: Why it's worth it

--

&lt;img src="gifs/dino-saurus.gif" style="display: block; margin: auto;" /&gt;

-- From ["Same Stats, Different Graphs: Generating Datasets with Varied Appearance and Identical Statistics through Simulated Annealing"](https://www.autodeskresearch.com/publications/samestats)

---
class: inverse, middle, center


&lt;img src="imgs/hex-visdat-and-naniar.png" width="70%" style="display: block; margin: auto;" /&gt;

.pull-left[
.center[
.hugew[
[visdat.njtierney.com](https://visdat.njtierney.com)
]
]
]

.pull-right[
.center[
.hugew[
[naniar.njtierney.com](https://naniar.njtierney.com)
]
]
]

---

## `visdat`

.pull-left[
&lt;img src="imgs/hex-visdat.png" width="231" style="display: block; margin: auto;" /&gt;
]

.pull-right[

[![rOpenSci Badge](https://badges.ropensci.org/87_status.svg)](https://github.com/ropensci/onboarding/issues/87)[![JOSS status](http://joss.theoj.org/papers/c85f57adbc565b064fb4bfc9b59a1b2a/status.svg)](http://joss.theoj.org/papers/c85f57adbc565b064fb4bfc9b59a1b2a)[![DOI](https://zenodo.org/badge/50553382.svg)](https://zenodo.org/badge/latestdoi/50553382)

&gt; published under "visdat: Visualising Whole Data Frames" in the Journal of Open Source Software

]

---


## `visdat::vis_dat(airquality)`

&lt;img src="figures/show-visdat-1.png" width="150%" style="display: block; margin: auto;" /&gt;


---

## `visdat::vis_miss(airquality)`

&lt;img src="figures/show-vis-miss-1.png" width="150%" style="display: block; margin: auto;" /&gt;


---

## `naniar`

.left-code[
&lt;img src="imgs/hex-naniar.png" width="231" style="display: block; margin: auto;" /&gt;
]

.right-plot.large[
  
Tierney, NJ. Cook, D. "Expanding tidy data principles to facilitate missing data exploration, visualization and assessment of imputations." [[Pre-print](https://arxiv.org/abs/1809.02264)]

]

---

## `naniar::gg_miss_var(airquality)`

&lt;img src="figures/gg-miss-var-1.png" width="150%" style="display: block; margin: auto;" /&gt;


---

## `naniar::gg_miss_upset(airquality)`

&lt;img src="figures/gg-miss-upset-1.png" width="150%" style="display: block; margin: auto;" /&gt;

---
class: middle, center, inverse

.vhuge[Current work:]

.huge[
How to explore longitudinal data effectively
]

---
class: inverse, middle,

# What is longitudinal data?

.huge[
&gt; Something observed sequentially over time
]


---

# What is longitudinal data?

.large[

```
## # A tsibble: 1 x 4 [!]
## # Key:       country [1]
##   country    year height_cm continent
##   &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;    
## 1 Australia  1910      173. Oceania
```
]

---

# What is longitudinal data?

.large[

```
## # A tsibble: 2 x 4 [!]
## # Key:       country [1]
##   country    year height_cm continent
##   &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;    
## 1 Australia  1910      173. Oceania  
## 2 Australia  1920      173. Oceania
```
]

---

# What is longitudinal data?

.large[

```
## # A tsibble: 3 x 4 [!]
## # Key:       country [1]
##   country    year height_cm continent
##   &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;    
## 1 Australia  1910      173. Oceania  
## 2 Australia  1920      173. Oceania  
## 3 Australia  1960      176. Oceania
```
]

---

# What is longitudinal data?

.large[

```
## # A tsibble: 4 x 4 [!]
## # Key:       country [1]
##   country    year height_cm continent
##   &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;    
## 1 Australia  1910      173. Oceania  
## 2 Australia  1920      173. Oceania  
## 3 Australia  1960      176. Oceania  
## 4 Australia  1970      178. Oceania
```
]

---

&lt;img src="figures/reveal-height-1.gif" width="150%" style="display: block; margin: auto;" /&gt;

---

&lt;img src="figures/gg-example-1.png" width="150%" style="display: block; margin: auto;" /&gt;

---

# All of Australia

&lt;img src="figures/gg-all-australia-1.png" width="936" style="display: block; margin: auto;" /&gt;


---

# ...And New Zealand

&lt;img src="figures/gg-show-a-few-countries-1.png" width="936" style="display: block; margin: auto;" /&gt;


---

# ... And Afghanistan and Albania

&lt;img src="figures/sample-more-heights-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

# And the rest?

&lt;img src="figures/animate-all-data-1.gif" style="display: block; margin: auto;" /&gt;

---

# And the rest?

&lt;img src="figures/gg-show-all-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

&lt;img src="gifs/noodle-explode.gif" width="50%" style="display: block; margin: auto;" /&gt;


---

# Problems:

.pull-left.large[
- Overplotting
- We don't see the individuals
- We could look at 153 individual plots, but this doesn't help.
]

.pull-right[
&lt;img src="figures/gg-heights-heights-again-1.png" width="936" style="display: block; margin: auto;" /&gt;
]

---

# Does transparency help?

&lt;img src="figures/gg-show-all-w-alpha-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

# Does transparency + a model help?

&lt;img src="figures/gg-show-all-w-model-1.png" width="936" style="display: block; margin: auto;" /&gt;

???

- This helps reduce the overplotting
- We only get the overall average. We dont get the rest of the information

---

# This is still useful

&lt;img src="figures/show-height-lm-1.png" width="936" style="display: block; margin: auto;" /&gt;

???

- We get information on what the average is, and how that behaves
- But we don't get the full story
- So, it depends on your need. If you have a designed experiment, where you stated that you would run some analysis, then you are doing this.
- ... But even then, wouldn't you rather _explore_ the data?
- Who fits the models well / worst / best?

---


# But we forget about the **individuals**

&lt;img src="figures/heights-dec-1.png" width="936" style="display: block; margin: auto;" /&gt;

???

- The model might make some good overall predictions
- But it can be really _ill suited_ for some individual
- Exploring this is somewhat clumsy - we need another way to explore


---

# How do we get the most out of this plot?


&lt;img src="figures/gg-height-highlight-2-1.png" width="936" style="display: block; margin: auto;" /&gt;

---
class: inverse, middle 

.large[
Problem #1: How do I look at **some** of the data?
]

--

.large[
Problem #2: How do I find **interesting** observations?
]

--

.large[
Problem #3: How do I **understand** my statistical model
]

---

# Introducing `brolgar`: brolgar.njtierney.com

.pull-left.large[
* **br**owsing
* **o**ver
* **l**ongitudinal data 
* **g**raphically, and
* **a**nalytically, in
* **r**
]

.pull-right[
&lt;img src="imgs/brolga-bird.jpg" width="569" style="display: block; margin: auto;" /&gt;
]

???

* It's a crane, it fishes, and it's a native Australian bird


---

&lt;img src="figures/gg-remind-spaghetti-1.png" width="200%" style="display: block; margin: auto;" /&gt;


---
class: inverse, middle, center

# What is longitudinal data?

.vlarge[
&gt; Something observed sequentially over time
]
---
class: inverse, middle, center

# What is longitudinal data?


.vlarge[
&gt; ~~Something~~ **Anything that is** observed sequentially over time **is a time series**
]

---
class: inverse, middle, center

# ~~What is longitudinal data?~~ Longitudinal data is a time series.


.vlarge[
&gt; ~~Something~~ **Anything that is** observed sequentially over time **is a time series**
]

.large[
[-- Rob Hyndman and George Athanasopolous,
Forecasting: Principles and Practice](https://otexts.com/fpp2/data-methods.html)
]

---

# Longitudinal data as a time series &lt;img src="https://tsibble.tidyverts.org/reference/figures/logo.png" align="right" height=140/&gt;



```r
heights &lt;- as_tsibble(heights,
                      index = year,
                      key = country,
*                     regular = FALSE)
```

1. **index**: Your time variable
2. **key**: Variable(s) defining individual groups (or series)

`1. +  2.` determine distinct rows in a tsibble.

(From Earo Wang's talk: [Melt the clock](https://slides.earo.me/rstudioconf19/#8))

---

# Longitudinal data as a time series &lt;img src="https://tsibble.tidyverts.org/reference/figures/logo.png" align="right" height=140/&gt;

## Key Concepts:

.large[
Record important time series information once, and use it many times in other places

- We add information about **index** + **key**
  - Index = Year
  - Key = Country
]
---

.large[

```
## # A tsibble: 1,499 x 4 [!]
## # Key:       country [153]
##   country      year height_cm continent
##   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;    
## 1 Afghanistan  1870      168. Asia     
## 2 Afghanistan  1880      166. Asia     
## 3 Afghanistan  1930      167. Asia     
## 4 Afghanistan  1990      167. Asia     
## 5 Afghanistan  2000      161. Asia     
## 6 Albania      1880      170. Europe   
## # … with 1,493 more rows
```
]

---
class: inverse, middle, center

.huge[
Remember: 

**key**  = variable(s) defining individual groups (or series)
]

---

# Problem #1: How do I look at **some** of the data?

--

.pull-left.large[
Look at only a sample of the data:
]

.pull-right.large[
&lt;img src="figures/ggplot-sample-keys-1.png" width="936" style="display: block; margin: auto;" /&gt;
]

---

# Sample `n` rows with `sample_n()`

--


```r
heights %&gt;% sample_n(5)
```

```
## # A tsibble: 5 x 4 [!]
## # Key:       country [5]
##   country        year height_cm continent
##   &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;    
## 1 Cote d'Ivoire  1890      169. Africa   
## 2 Argentina      1810      169. Americas 
## 3 United States  1920      173. Americas 
## 4 Netherlands    1810      166  Europe   
## 5 Nigeria        1870      166. Africa
```


---

# Sample `n` rows with `sample_n()`

&lt;img src="figures/plot-sample-n-1.png" width="936" style="display: block; margin: auto;" /&gt;


---

# Sample `n` rows with `sample_n()`


```
## # A tsibble: 5 x 4 [!]
## # Key:       country [5]
##   country      year height_cm continent
##   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;    
## 1 Malawi       1940      166. Africa   
## 2 Italy        1960      173  Europe   
## 3 Kazakhstan   1850      165. Asia     
## 4 Colombia     1980      171. Americas 
## 5 Switzerland  1910      172. Europe
```

--

.large[
... sampling needs to select not random rows of the data, but the **keys - the countries**.
]

---


# `sample_n_keys()` to sample ... **keys**


```r
sample_n_keys(heights, 5)
```


```
## # A tsibble: 35 x 4 [!]
## # Key:       country [5]
##   country     year height_cm continent
##   &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;    
## 1 Azerbaijan  1850      170. Asia     
## 2 Azerbaijan  1860      171. Asia     
## 3 Azerbaijan  1950      171. Asia     
## 4 Azerbaijan  1960      172. Asia     
## 5 Azerbaijan  1970      172. Asia     
## 6 Azerbaijan  1980      172. Asia     
## # … with 29 more rows
```

---

# `sample_n_keys()` to sample ... **keys**

&lt;img src="figures/ggplot-sample-keys-2-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

# Problem #1: How do I look at **some** of the data?


.large[
~~Look at subsamples~~
]

--

.large[
Look at **many** subsamples
]

---

# Look at many subsamples

&lt;img src="figures/all-heights-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

# Look at many subsamples

&lt;img src="figures/all-heights-samples-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

# Look at many subsamples

&lt;img src="figures/heights-strata-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

# **How** to look at many subsamples

.large[
- How many facets to look at? (2, 4, ... 16?)
- How many keys per facets?
  - 153 keys into 16 facets = 9 each
- Randomly pick 16 groups of size 9.
]

--

.large[
- This might not look like much extra work, but it hits the
**distraction threshold** quite quickly.
]

---

# Distraction threshold (time to rabbit hole)

--

.large[

(Something I made up)
]

--

.large[
&gt; If you have to solve 3+ substantial smaller problems in order to solve a larger problem, your focus shifts from the current goal to something else. 
You are distracted.

]

---

# Distraction threshold (time to rabbit hole)

**I want to look at many subsamples of the data** 

--

How many keys are there?

--

How many facets do I want to look at

--

How many keys per facet should I look at

--

How do I ensure there are the same number of keys per plot

--

What is `rep`, `rep.int`, and `rep_len`?

--

Do I want `length.out` or `times`?


---

# Avoiding the rabbit hole

--

.large[
We can blame ourselves when we are distracted for not being better.
]

--

.large[
It's not that we should be better, rather **with better tools we could be more efficient**. 
]

--

.large[
We need to make things as easy as reasonable, with the least amount of distraction.
]


---

# Removing the distraction threshold means asking the most relevant question

--

.large[
&gt; How many plots do I want to look at?
]

--


```r
gg_heights(heights) + 
  facet_sample(
*   n_per_facet = 3,
*   n_facets = 9
  )
```

---

&lt;img src="figures/show-facet-sample-print-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---

# `facet_sample()`: See more individuals


```r
ggplot(heights, aes(x = year, 
                    y = height_cm, 
                    group = country)) + 
  geom_line() 
```

&lt;img src="figures/gg-facet-sample-all-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---

# `facet_sample()`: See more individuals


```r
ggplot(heights,
       aes(x = year,
             y = height_cm,
             group = country)) + 
  geom_line() + 
* facet_sample()
```

---

# `facet_sample()`: See more individuals

&lt;img src="figures/print-gg-facet-sample-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

# `facet_strata()`: See all individuals


```r
ggplot(heights,
       aes(x = year,
             y = height_cm,
             group = country)) + 
  geom_line() + 
* facet_strata()
```

---

# `facet_strata()`: See all individuals

&lt;img src="figures/print-gg-facet-strata-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

# Focus on answering relevant questions instead of the minutae:

.pull-left[
"How many lines per facet"

"How many facets?"


```r
ggplot + 
  facet_sample(
*   n_per_facet = 10,
*   n_facets = 12
    ) 
```

]

--

.pull-right[
"How many facets to shove all the data in?"


```r
ggplot + 
  facet_strata(
*   n_strata = 10,
    ) 
```

]

---

## Can we re-order these facets in a meaningful way?

&lt;img src="figures/print-gg-facet-strata-again-1.png" width="936" style="display: block; margin: auto;" /&gt;

???

In asking these questions we can solve something else interesting

---

## `facet_strata(along = -year)`: see all individuals **along** some variable


```r
ggplot(heights,
       aes(x = year,
             y = height_cm,
             group = country)) + 
  geom_line() + 
* facet_strata(along = -year)
```

---

## `facet_strata(along = -year)`: see all individuals **along** some variable

&lt;img src="figures/print-gg-facet-strata-along-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

# `facet_strata()` &amp; `facet_sample()` Under the hood

.large[
- <i class="fas  fa-industry "></i> using `sample_n_keys()` and `stratify_keys()`
]

--

.large[
- So you can still get at the data and do more manipulations
]

---

## Problem #1: How do I look at some of the data?

--

.pull-left.large[

`as_tsibble()`

`sample_n_keys()`

`facet_sample()`

`facet_strata()`

]

--


.pull-right.medium[

Store useful information

View subsamples of data

View many subsamples

View all subsamples

]


---

## ~~Problem #1: How do I look at some of the data?~~

.pull-left.large[

`as_tsibble()`

`sample_n_keys()`

`facet_sample()`

`facet_strata()`

]


.pull-right.medium[

Store useful information

View subsamples of data

View many subsamples

View all subsamples

]


---

## Problem #2: How do I find **interesting** observations?

&lt;img src="figures/quite-interesting-obs-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

## Problem #2: How do I find **interesting** observations?

&lt;img src="figures/quite-interesting-obs-2-1.png" width="936" style="display: block; margin: auto;" /&gt;

---
class: inverse, center, middle

.huge[
**Define** interesting?
]


---

## Identify features: summarise down to one observation




&lt;img src="figures/anim-line-flat-max-1.gif" style="display: block; margin: auto;" /&gt;


---

## Identify features: summarise down to one observation

&lt;img src="figures/show-line-range-point-1.png" width="936" style="display: block; margin: auto;" /&gt;


---

## Identify features: summarise down to one observation

&lt;img src="figures/gg-show-point-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

## Identify important features and decide how to filter 

&lt;img src="figures/gg-show-red-points-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

## Identify important features and decide how to filter 

&lt;img src="figures/gg-just-red-points-1.png" width="936" style="display: block; margin: auto;" /&gt;


---

## Join this feature back to the data

&lt;img src="figures/gg-join-red-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

## Join this feature back to the data

&lt;img src="figures/gg-join-red-show-all-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

## 🎉 Countries with smallest and largest max height

&lt;img src="figures/show-red-all-again-1.png" width="936" style="display: block; margin: auto;" /&gt;

---
class: inverse, middle, cetner

.vhuge[
Let's see that **one more time**, but with the data
]

---

## Identify features: summarise down to one observation


```
## # A tsibble: 1,499 x 4 [!]
## # Key:       country [153]
##    country      year height_cm continent
##    &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;    
##  1 Afghanistan  1870      168. Asia     
##  2 Afghanistan  1880      166. Asia     
##  3 Afghanistan  1930      167. Asia     
##  4 Afghanistan  1990      167. Asia     
##  5 Afghanistan  2000      161. Asia     
##  6 Albania      1880      170. Europe   
##  7 Albania      1890      170. Europe   
##  8 Albania      1900      169. Europe   
##  9 Albania      2000      168. Europe   
## 10 Algeria      1910      169. Africa   
## # … with 1,489 more rows
```

---

## Identify features: summarise down to one observation


```
## # A tibble: 153 x 6
##    country       min   q25   med   q75   max
##    &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Afghanistan  161.  164.  167.  168.  168.
##  2 Albania      168.  168.  170.  170.  170.
##  3 Algeria      166.  168.  169   170.  171.
##  4 Angola       159.  160.  167.  168.  169.
##  5 Argentina    167.  168.  168.  170.  174.
##  6 Armenia      164.  166.  169.  172.  172.
##  7 Australia    170   171.  172.  173.  178.
##  8 Austria      162.  164.  167.  169.  179.
##  9 Azerbaijan   170.  171.  172.  172.  172.
## 10 Bahrain      161.  161.  164.  164.  164 
## # … with 143 more rows
```

---

## Identify important features and decide how to filter 


```r
heights_five %&gt;% 
  filter(max == max(max) | max == min(max))
```

```
## # A tibble: 2 x 6
##   country            min   q25   med   q75   max
##   &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Denmark           165.  168.  170.  178.  183.
## 2 Papua New Guinea  152.  152.  156.  160.  161.
```

---

## Join summaries back to data


```r
heights_five %&gt;% 
  filter(max == max(max) | max == min(max)) %&gt;% 
  left_join(heights, by = "country")
```

```
## # A tibble: 21 x 9
##    country   min   q25   med   q75   max  year height_cm continent
##    &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;    
##  1 Denmark  165.  168.  170.  178.  183.  1820      167. Europe   
##  2 Denmark  165.  168.  170.  178.  183.  1830      165. Europe   
##  3 Denmark  165.  168.  170.  178.  183.  1850      167. Europe   
##  4 Denmark  165.  168.  170.  178.  183.  1860      168. Europe   
##  5 Denmark  165.  168.  170.  178.  183.  1870      168. Europe   
##  6 Denmark  165.  168.  170.  178.  183.  1880      170. Europe   
##  7 Denmark  165.  168.  170.  178.  183.  1890      169. Europe   
##  8 Denmark  165.  168.  170.  178.  183.  1900      170. Europe   
##  9 Denmark  165.  168.  170.  178.  183.  1910      170  Europe   
## 10 Denmark  165.  168.  170.  178.  183.  1920      174. Europe   
## # … with 11 more rows
```

---

&lt;img src="gifs/dog-solve-problem.gif" width="70%" style="display: block; margin: auto;" /&gt;

---

## Identify features: one per **key** &lt;img src="https://feasts.tidyverts.org/reference/figures/logo.png" align="right" height=140/&gt;


```r
heights %&gt;%
* features(height_cm,
*          feat_five_num)
```
 

```
## # A tibble: 153 x 6
##   country       min   q25   med   q75   max
##   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Afghanistan  161.  164.  167.  168.  168.
## 2 Albania      168.  168.  170.  170.  170.
## 3 Algeria      166.  168.  169   170.  171.
## 4 Angola       159.  160.  167.  168.  169.
## 5 Argentina    167.  168.  168.  170.  174.
## 6 Armenia      164.  166.  169.  172.  172.
## # … with 147 more rows
```

---

## features: Summaries that are **aware of data structure** &lt;img src="https://feasts.tidyverts.org/reference/figures/logo.png" align="right" height=140/&gt;

--


```r
heights %&gt;%
  features(height_cm, #&lt;&lt; # variable we want to summarise
           feat_five_num) #&lt;&lt; # feature to calculate
```

--


```
## # A tibble: 153 x 6
##   country       min   q25   med   q75   max
##   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Afghanistan  161.  164.  167.  168.  168.
## 2 Albania      168.  168.  170.  170.  170.
## 3 Algeria      166.  168.  169   170.  171.
## 4 Angola       159.  160.  167.  168.  169.
## 5 Argentina    167.  168.  168.  170.  174.
## 6 Armenia      164.  166.  169.  172.  172.
## # … with 147 more rows
```

---

## features: what is `feat_five_num?` &lt;img src="https://feasts.tidyverts.org/reference/figures/logo.png" align="right" height=140/&gt;

--


```r
feat_five_num
```

```
## function(x, ...) {
##   list(
##     min = b_min(x, ...),
##     q25 = b_q25(x, ...),
##     med = b_median(x, ...),
##     q75 = b_q75(x, ...),
##     max = b_max(x, ...)
##   )
## }
## &lt;bytecode: 0x7fb6bc8fcba0&gt;
## &lt;environment: namespace:brolgar&gt;
```


---

## features: what is `feat_five_num?` &lt;img src="https://feasts.tidyverts.org/reference/figures/logo.png" align="right" height=140/&gt;

.huge[
[Create your own features (from brolgar.njtierney.com)](http://brolgar.njtierney.com/articles/finding-features.html#creating-your-own-features)
]

---
class: middle, center
# Other available `features()` in `brolgar` 

---

## What is the range of the data? `feat_ranges`


```r
heights %&gt;%
  features(height_cm, feat_ranges)
```

```
## # A tibble: 153 x 5
##    country       min   max range_diff   iqr
##    &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;
##  1 Afghanistan  161.  168.       7     3.27
##  2 Albania      168.  170.       2.20  1.53
##  3 Algeria      166.  171.       5.06  2.15
##  4 Angola       159.  169.      10.5   7.87
##  5 Argentina    167.  174.       7     2.21
##  6 Armenia      164.  172.       8.82  5.30
##  7 Australia    170   178.       8.4   2.58
##  8 Austria      162.  179.      17.2   5.35
##  9 Azerbaijan   170.  172.       1.97  1.12
## 10 Bahrain      161.  164        3.3   2.75
## # … with 143 more rows
```

---

## Does my data only increase or decrease? `feat_monotonic`


```r
heights %&gt;%
  features(height_cm, feat_monotonic)
```

```
## # A tibble: 153 x 5
##    country     increase decrease unvary monotonic
##    &lt;chr&gt;       &lt;lgl&gt;    &lt;lgl&gt;    &lt;lgl&gt;  &lt;lgl&gt;    
##  1 Afghanistan FALSE    FALSE    FALSE  FALSE    
##  2 Albania     FALSE    TRUE     FALSE  TRUE     
##  3 Algeria     FALSE    FALSE    FALSE  FALSE    
##  4 Angola      FALSE    FALSE    FALSE  FALSE    
##  5 Argentina   FALSE    FALSE    FALSE  FALSE    
##  6 Armenia     FALSE    FALSE    FALSE  FALSE    
##  7 Australia   FALSE    FALSE    FALSE  FALSE    
##  8 Austria     FALSE    FALSE    FALSE  FALSE    
##  9 Azerbaijan  FALSE    FALSE    FALSE  FALSE    
## 10 Bahrain     TRUE     FALSE    FALSE  TRUE     
## # … with 143 more rows
```

---

## What is the spread of my data? `feat_spread`


```r
heights %&gt;%
  features(height_cm, feat_spread)
```

```
## # A tibble: 153 x 5
##    country        var    sd   mad   iqr
##    &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Afghanistan  7.20  2.68  1.65   3.27
##  2 Albania      0.950 0.975 0.667  1.53
##  3 Algeria      3.30  1.82  0.741  2.15
##  4 Angola      16.9   4.12  3.11   7.87
##  5 Argentina    2.89  1.70  1.36   2.21
##  6 Armenia     10.6   3.26  3.60   5.30
##  7 Australia    7.63  2.76  1.66   2.58
##  8 Austria     26.6   5.16  3.93   5.35
##  9 Azerbaijan   0.516 0.718 0.621  1.12
## 10 Bahrain      3.42  1.85  0.297  2.75
## # … with 143 more rows
```

---

## features: MANY more features in `feasts` &lt;img src="https://feasts.tidyverts.org/reference/figures/logo.png" align="right" height=140/&gt;

.large[
Such as:

- `feat_acf`: autocorrelation-based features
- `feat_stl`: STL (Seasonal, Trend, and Remainder by LOESS) decomposition
]

---

# ~~Problem #1: How do I look at **some** of the data?~~

--

# Problem #2: How do I find **interesting** observations?

--

.large[
- Decide what features are interesting
- Summarise down to one observation
- Decide how to filter 
- Join this feature back to the data
]

---

# ~~Problem #1: How do I look at **some** of the data?~~

# ~~Problem #2: How do I find **interesting** observations?~~

--

# Problem #3: How do I **understand** my statistical model


---

# Problem #3: How do I **understand** my statistical model

.medium[
Let's fit a simple mixed effects model to the data

Fixed effect of year + Random intercept for country
]


```r
heights_fit &lt;- lmer(height_cm ~ year + (1|country), heights)

heights_aug &lt;- heights %&gt;%
  add_predictions(heights_fit, var = "pred") %&gt;%
  add_residuals(heights_fit, var = "res")
```

---

# Problem #3: How do I **understand** my statistical model



```
## # A tsibble: 1,499 x 6 [!]
## # Key:       country [153]
##    country      year height_cm continent  pred    res
##    &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;
##  1 Afghanistan  1870      168. Asia       164.  4.58 
##  2 Afghanistan  1880      166. Asia       164.  1.51 
##  3 Afghanistan  1930      167. Asia       166.  0.815
##  4 Afghanistan  1990      167. Asia       168. -1.05 
##  5 Afghanistan  2000      161. Asia       169. -7.11 
##  6 Albania      1880      170. Europe     168.  2.40 
##  7 Albania      1890      170. Europe     168.  1.74 
##  8 Albania      1900      169. Europe     168.  0.775
##  9 Albania      2000      168. Europe     172. -4.13 
## 10 Algeria      1910      169. Africa     168.  1.28 
## # … with 1,489 more rows
```

---

# Problem #3: How do I **understand** my statistical model

&lt;img src="figures/fits-1.png" width="936" style="display: block; margin: auto;" /&gt;

---

## Look at **some** subsamples?


```r
gg_heights_fit + facet_sample()
```

&lt;img src="figures/heights-fit-facet-sample-1.png" width="70%" style="display: block; margin: auto;" /&gt;

---

## Look at **all** subsamples?


```r
gg_heights_fit + facet_strata()
```

&lt;img src="figures/heights-fit-facet-strata-1.png" width="70%" style="display: block; margin: auto;" /&gt;

---

## Look at **all subsamples** arranged by residuals?


```r
gg_heights_fit + facet_strata(along = -res)
```

&lt;img src="figures/heights-fit-facet-strata-res-1.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# Look at the predictions with the data?

.left-code[

```r
set.seed(2019-11-13)
heights_sample &lt;- 
heights_aug %&gt;%
  sample_n_keys(size = 9) %&gt;% #&lt;&lt; sample the data
  ggplot(aes(
    x = year,
    y = pred,
    group = country)) + 
  geom_line() +
  facet_wrap(~country)

heights_sample
```
]

.right-plot[
&lt;img src="figures/small-sample-out-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

# Look at the predictions with the data?

.left-code[

```r
heights_sample +
  geom_point(
    aes(
      y = height_cm #&lt;&lt; add the original data
      ))  
```
]

.right-plot[
&lt;img src="figures/small-sample-add-real-data-out-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

# What if we grabbed a sample of those who have the best, middle, and worst residuals? 

--


```r
summary(heights_aug$res)
```

```
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  -8.167  -1.614  -0.157   0.000   1.352  12.174
```

--

.large[
Which countries are **nearest** to these statistics?
]

---

# use `keys_near()`

.pull-left[

```r
heights_aug %&gt;%
  keys_near(key = country,
            var = res)
```

```
## # A tibble: 5 x 5
##   country       res stat  stat_value  stat_diff
##   &lt;chr&gt;       &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;      &lt;dbl&gt;
## 1 Ireland    -8.17  min       -8.17  0         
## 2 Vietnam    -1.61  q_25      -1.61  0.00000278
## 3 Mauritania -0.157 med       -0.157 0         
## 4 Sudan       1.35  q_75       1.35  0.000174  
## 5 Poland     12.2   max       12.2   0
```
]

.pull-right[


&gt; This shows us the keys that closely match the five number summary. 

]

---

# Show data by joining it with predictions, to explore the spread of predictions.

.left-code[

```r
left_join(heights_near,
          heights_aug,
          by = "country") %&gt;%
  ggplot(aes(x = year,
             y = pred,
             group = country,
             colour = stat)) + 
  geom_line() + 
  geom_point(aes(y = height_cm)) + 
  facet_wrap(~country)
```
]

.right-plot[
&lt;img src="figures/plot-join-aug-out-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

# Take homes

## Problem #1: How do I look at **some** of the data?


.large[
1. Longitudinal data is a time series
2. Specify structure once, get a free lunch.
3. Look at as much of the raw data as possible 
4. Use `facet_sample()` / `facet_strata()` to look at data
]

---

# Take homes

## Problem #2: How do I find **interesting** observations?

.large[
5. Summarise with `features` to find interesting observations
6. Reconnect summaries to data with a **left join**
]


---

# Take homes

## Problem #3: How do I **understand** my statistical model

.large[
1. Look at (one, more or all!) subsamples
1. Arrange subsamples
1. Find keys near some summary 
1. Join keys to data to explore representatives
]

---

# Thanks

.large[
- Di Cook
- Tania Prvan
- Stuart Lee
- Mitchell O'Hara Wild
- Earo Wang
- Rob Hyndman
- Miles McBain
- Monash University
]

---

# Resources

.large[
- [feasts](http://feasts.tidyverts.org/)
- [tsibble](http://tsibble.tidyverts.org/)
- [Time series graphics using feasts](https://robjhyndman.com/hyndsight/feasts/)
- [Feature-based time series analysis](https://robjhyndman.com/hyndsight/fbtsa/)
]

---

# Colophon

.large[
- Slides made using [xaringan](https://github.com/yihui/xaringan)
- Extended with [xaringanthemer](https://github.com/gadenbuie/xaringanthemer)
- Colours taken + modified from [lorikeet theme from ochRe](https://github.com/ropenscilabs/ochRe)
- Header font is **Josefin Sans**
- Body text font is **Montserrat**
- Code font is **Fira Mono**
]

---

# Learning more

.large[
<i class="fas  fa-box-open "></i> [brolgar.njtierney.com](http://brolgar.njtierney.com/)

<i class="fas  fa-link "></i> [bit.ly/njt-anu](https://bit.ly/njt-anu)

<i class="fab  fa-twitter "></i> nj_tierney

<i class="fab  fa-github "></i> njtierney

<i class="fas  fa-paper-plane "></i> nicholas.tierney@gmail.com

]


---

.vhuge[
**End.**
]

???

- now let's go through these same principles:
  - Sample the fits
  - Many samples of the fits
  - Explore the residuals
  - Find the best, worst, middle of the ground residuals
  - follow the "gliding" process again.
  
- Which are most similar to which stats?
  - "who is similar to me?"
  - "who is the most average?"
  - "who is the most extreme?"
  - "Who is the most different to me?"

# EDA: Why it's worth it

Anscombe's quartet
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
